<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fursys.mobilecm.mapper.ErpSigongAsMapper">


 
<select id="selectOrderItemLoadingIssueList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPOrderItemLoadingIssueList">
<![CDATA[

    SELECT A.ORM_NO, A.ORM_NM, B.LOADINGISSUE_STD,
           (SELECT Z.CCD_NM FROM TT_COMCD Z WITH (NOLOCK) WHERE Z.CDX_CD = 'C88' AND Z.CCD_CD = B.LOADINGISSUE_STD) AS LOADINGISSUE_STD_NM,
           ISNULL(B.LOADINGISSUE_PROCSTD, '') LOADINGISSUE_PROCSTD,
           ISNULL((SELECT Z.CCD_NM FROM TT_COMCD Z WITH (NOLOCK) WHERE Z.CDX_CD = 'C89' AND Z.CCD_CD = B.LOADINGISSUE_PROCSTD), '') AS LOADINGISSUE_PROCSTD_NM,
           B.REM_DT, B.REM_SEQ, B.COM_SSEC, B.SEQ_NO, B.ITM_CD, B.COL_CD,
		   (SELECT ITM.ITM_NM FROM TT_ITMMST ITM  WITH (NOLOCK)  WHERE ITM.ITM_CD = B.ITM_CD AND ITM.COL_CD = B.COL_CD ) AS ITM_NM
	  FROM TC_RESMST A WITH(NOLOCK), TC_LOADINGISSUE B WITH(NOLOCK)
	 WHERE A.REM_DT = B.REM_DT
	   AND A.REM_SEQ = B.REM_SEQ
	   AND A.COM_SSEC = B.COM_SSEC
	   AND A.PLM_NO = #{plm_no}
	   AND A.COM_SSEC = #{com_ssec}
	 ORDER BY B.SEQ_NO 
]]>
</select>
   
<update id="deleteLoadingIssueInfo" parameterType="HashMap">
<![CDATA[

	DELETE FROM TC_LOADINGISSUE
	 WHERE REM_DT = #{rem_dt}
	   AND REM_SEQ = #{rem_seq}
	   AND COM_SSEC = #{com_ssec}
	   AND SEQ_NO = #{seq_no}

]]>
</update> 
 
<select id="selectLoadingIssue" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPLoadingIssue">
<![CDATA[

	SELECT X.REM_DT, X.REM_SEQ, X.COM_SSEC, X.SEQ_NO, X.ORM_NO, X.PLM_NO, X.ITM_CD, X.ITM_NM, X.COL_CD, SUM(X.PLD_FQTY) AS PLD_FQTY,
		       X.LOADINGISSUE_STD, X.LOADINGISSUE_STD_NM, X.LOADINGISSUE_REMARK, X.LOADINGISSUE_PROCSTD, X.LOADINGISSUE_PROCSTD_NM, X.LOADINGISSUE_PROCREMARK,
			   X.USR_CD, X.SYS_DT
		  FROM (
		SELECT A.REM_DT, A.REM_SEQ, A.COM_SSEC, A.SEQ_NO, A.ORM_NO, A.PLM_NO, A.ITM_CD, B.PLD_FQTY,
			(SELECT ITM.ITM_NM FROM TT_ITMMST ITM  WITH (NOLOCK)  WHERE ITM.ITM_CD = A.ITM_CD AND ITM.COL_CD = A.COL_CD ) AS ITM_NM,
			 A.COL_CD, A.LOADINGISSUE_STD, 
			   (SELECT Z.CCD_NM FROM TT_COMCD Z WITH (NOLOCK) WHERE Z.CDX_CD = 'C88' AND Z.CCD_CD = A.LOADINGISSUE_STD) AS LOADINGISSUE_STD_NM,
			   A.LOADINGISSUE_REMARK, A.LOADINGISSUE_PROCSTD,
			   (SELECT Z.CCD_NM FROM TT_COMCD Z WITH (NOLOCK) WHERE Z.CDX_CD = 'C89' AND Z.CCD_CD = A.LOADINGISSUE_PROCSTD) AS LOADINGISSUE_PROCSTD_NM,
			   A.LOADINGISSUE_PROCREMARK, A.USR_CD, CONVERT(VARCHAR(16), A.SYS_DT, 120) SYS_DT
		  FROM TC_LOADINGISSUE A WITH(NOLOCK), TC_PLANDTL B WITH (NOLOCK)
		 WHERE A.REM_DT = #{rem_dt} 
		   AND A.REM_SEQ = #{rem_seq}
		   AND A.COM_SSEC = #{com_ssec}
		   AND A.SEQ_NO = #{seq_no}
		   AND A.PLM_NO = B.PLM_NO
		   AND A.ITM_CD = B.ITM_CD
		   AND A.COL_CD = B.COL_CD
		   AND B.COM_PLDSEC IN ('C092', 'C090', 'C09A')
		   AND ( B.ITM_CD NOT LIKE 'EXTRA%' AND B.ITM_CD NOT LIKE 'ZERO%' )
		   AND ( B.ITM_CD NOT IN ('HW00E15EE', 'HW00E24EE', 'HW00E25EE', 'HW01E15EE', 'HW01E24EE', 'HW01E25EE', 'C37', 'X1', 'AS-1A-000'))
		   AND B.PLD_FQTY <> 0
		UNION ALL
		SELECT A.REM_DT, A.REM_SEQ, A.COM_SSEC, A.SEQ_NO, A.ORM_NO, A.PLM_NO, A.ITM_CD, B.PLD_FQTY,
			(SELECT ITM.ITM_NM FROM TT_ITMMST ITM  WITH (NOLOCK)  WHERE ITM.ITM_CD = A.ITM_CD AND ITM.COL_CD = A.COL_CD ) AS ITM_NM,
			 A.COL_CD, A.LOADINGISSUE_STD, 
			   (SELECT Z.CCD_NM FROM TT_COMCD Z WITH (NOLOCK) WHERE Z.CDX_CD = 'C88' AND Z.CCD_CD = A.LOADINGISSUE_STD) AS LOADINGISSUE_STD_NM,
			   A.LOADINGISSUE_REMARK, A.LOADINGISSUE_PROCSTD,
			   (SELECT Z.CCD_NM FROM TT_COMCD Z WITH (NOLOCK) WHERE Z.CDX_CD = 'C89' AND Z.CCD_CD = A.LOADINGISSUE_PROCSTD) AS LOADINGISSUE_PROCSTD_NM,
			   A.LOADINGISSUE_PROCREMARK, A.USR_CD, CONVERT(VARCHAR(16), A.SYS_DT, 120) SYS_DT
		  FROM TC_LOADINGISSUE A WITH(NOLOCK), TA_PLANDTL B WITH (NOLOCK)
		 WHERE A.REM_DT = #{rem_dt} 
		   AND A.REM_SEQ = #{rem_seq}
		   AND A.COM_SSEC = #{com_ssec}
		   AND A.SEQ_NO = #{seq_no}
		   AND A.PLM_NO = B.PLM_NO
		   AND A.ITM_CD = B.BMT_ITEM
		   AND A.COL_CD = B.COL_CD
		   AND B.PLD_FQTY <> 0		   
		) X
		GROUP BY  X.REM_DT, X.REM_SEQ, X.COM_SSEC, X.SEQ_NO, X.ORM_NO, X.PLM_NO, X.ITM_CD, X.ITM_NM, X.COL_CD,
		       X.LOADINGISSUE_STD, X.LOADINGISSUE_STD_NM, X.LOADINGISSUE_REMARK, X.LOADINGISSUE_PROCSTD, X.LOADINGISSUE_PROCSTD_NM, X.LOADINGISSUE_PROCREMARK,
			   X.USR_CD, X.SYS_DT
  
]]>
</select>
   
<select id="selectLoadingIssueStdList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPTtComcd">
<![CDATA[

	SELECT A.CCD_CD, A.CCD_NM 
	  FROM TT_COMCD A WITH(NOLOCK)
	 WHERE A.CDX_CD = #{cdx_cd}
	 ORDER BY A.SORT_SEQ
  
]]>
</select>
 
<select id="selectMobileContentReqProc" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[

	SELECT ISNULL(A.REQ_PROC, '') AS DATA1
	  FROM TC_MOBILECONTENT A WITH (NOLOCK)
	 WHERE REQ_NO = #{req_no}
 
]]> 
</select>
 
<update id="updateMobileContent" parameterType="HashMap">
<![CDATA[
	UPDATE TC_MOBILECONTENT
	   SET REQ_STD = #{req_std},
	       REQ_TITLE = #{req_title},
	       REQ_CONTENT = #{req_content},
	       SYS_DT = GETDATE()
	 WHERE REQ_NO = #{req_no} 

]]>
</update>

<insert id="insertMobileContent" parameterType="HashMap">
<selectKey keyProperty="req_no" resultType="Integer" order="AFTER"> 
	SELECT IDENT_CURRENT('TC_MOBILECONTENT')
</selectKey>
<![CDATA[
	INSERT INTO TC_MOBILECONTENT (
	       REQ_DT,
	       REQ_USR_CD,
	       REQ_STD,
	       REQ_PROC,
	       REQ_TITLE,
	       REQ_CONTENT,
	       ANS_CONTENT,
	       ANS_DT,
	       ANS_USR_CD,
	       FST_USR_CD,
	       FST_SYS_DT,
	       USR_CD,	       
	       SYS_DT,
	       COM_SCD)
	 VALUES (
	       GETDATE(),
	       #{user_id},
	       #{req_std},
	       #{req_proc},
	       #{req_title},
	       #{req_content},
	       NULL,
	       NULL,
	       NULL,
	       #{user_id},
	       GETDATE(),
	       #{user_id},	       
	       GETDATE(),
	       #{com_scd})

]]> 
</insert>
 
<select id="selectMobileContent" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPMobileContent">
<![CDATA[

	 SELECT A.REQ_NO, CONVERT(VARCHAR(16), A.REQ_DT, 120) REQ_DT, A.REQ_USR_CD, A.REQ_STD, B.CCD_NM REQ_STD_NM, A.REQ_PROC, C.CCD_NM REQ_PROC_NM, A.REQ_TITLE, A.REQ_CONTENT,
	        ISNULL(A.ANS_CONTENT, '') ANS_CONTENT, ISNULL(CONVERT(VARCHAR(16), A.ANS_DT, 120), '') ANS_DT, ISNULL(A.ANS_USR_CD, '') ANS_USR_CD,
	        A.FST_USR_CD, CONVERT(VARCHAR(16), A.FST_SYS_DT, 120) FST_SYS_DT, A.USR_CD, CONVERT(VARCHAR(16), A.SYS_DT, 120) SYS_DT
	   FROM TC_MOBILECONTENT A WITH(NOLOCK), TT_COMCD B WITH(NOLOCK), TT_COMCD C WITH(NOLOCK)
	  WHERE A.REQ_STD = B.CCD_CD
	    AND A.REQ_PROC = C.CCD_CD
	    AND A.REQ_NO = #{req_no}
  
]]> 
</select>
    
<select id="selectMobileContentList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPMobileContentList">
<![CDATA[

	 SELECT A.REQ_NO, CONVERT(VARCHAR(16), A.REQ_DT, 120) REQ_DT, A.REQ_USR_CD, A.REQ_STD, B.CCD_NM REQ_STD_NM, A.REQ_PROC, C.CCD_NM REQ_PROC_NM, A.REQ_TITLE, A.REQ_CONTENT,
	        ISNULL(A.ANS_CONTENT, '') ANS_CONTENT, ISNULL(CONVERT(VARCHAR(16), A.ANS_DT, 120), '') ANS_DT, ISNULL(A.ANS_USR_CD, '') ANS_USR_CD,
	        A.FST_USR_CD, CONVERT(VARCHAR(16), A.FST_SYS_DT, 120) FST_SYS_DT, A.USR_CD, CONVERT(VARCHAR(16), A.SYS_DT, 120) SYS_DT,
	        (SELECT COUNT(ATTCH_FILE_ID) FROM TY_ATTCHFILE WITH(NOLOCK) WHERE ATTCH_FILE_ID = #{attch_file_id} + CONVERT(VARCHAR(10), A.REQ_NO) AND ATTCH_DIV_CD = #{attch_div_cd}) AS FILE_CNT
	   FROM TC_MOBILECONTENT A WITH(NOLOCK), TT_COMCD B WITH(NOLOCK), TT_COMCD C WITH(NOLOCK)
	  WHERE A.REQ_STD = B.CCD_CD
	    AND A.REQ_PROC = C.CCD_CD
	    AND A.REQ_DT >= CONVERT(DATETIME, #{fr_date}) 
	    AND A.REQ_DT <= CONVERT(DATETIME, #{to_date})
		AND A.REQ_STD LIKE #{req_std}
	  ORDER BY A.REQ_NO DESC
  
]]> 
</select>
     
<select id="selectReqStdList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPTtComcd">
<![CDATA[

	SELECT A.CCD_CD, A.CCD_NM 
	  FROM TT_COMCD A WITH(NOLOCK)
	 WHERE A.CDX_CD = 'C86'
	 ORDER BY A.SORT_SEQ
  
]]>
</select>

<select id="selectAddActStat" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[

	SELECT A.ADDACT_STAT AS DATA1
	  FROM TC_ADDACTREQ A WITH (NOLOCK)
	 WHERE A.PLM_NO = #{plm_no}
	   AND A.COM_SSEC = #{com_ssec}
	   AND A.SEQ = #{seq}
 
]]> 
</select>

<select id="erp_selectConsumerAmt" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[

	SELECT ISNULL(SUM(IOP_MNFCST*ORD_QTY), -9999) AS VALUE1, ISNULL(SUM(IOP_SALCST_REC*ORD_QTY), -9999) AS VALUE2
	  FROM TO_ORDDET D WITH(NOLOCK) INNER JOIN TC_PLANMST P WITH(NOLOCK) ON D.ORM_NO = P.ORM_NO
	 WHERE PLM_NO = #{plm_no}

]]> 
</select>
 
<update id="deleteAddAct" parameterType="HashMap">
<![CDATA[
	UPDATE TC_ADDACTREQ
	   SET ADDACT_STAT = 'C83004',
	       USR_CD = #{user_id},
	       SYS_DT = GETDATE()
	 WHERE PLM_NO = #{plm_no}
	   AND COM_SSEC = #{com_ssec}
	   AND SEQ = #{seq}
	
]]>
</update>

<update id="deleteAddActDetailAll" parameterType="HashMap">
<![CDATA[
	DELETE FROM TC_ADDACTREQ_DTL
	 WHERE PLM_NO = #{plm_no}
	   AND COM_SSEC = #{com_ssec}
	   AND SEQ = #{seq}
	
]]>
</update> 

<update id="deleteAddActDetail" parameterType="HashMap">
<![CDATA[
	DELETE FROM TC_ADDACTREQ_DTL
	 WHERE PLM_NO = #{plm_no}
	   AND COM_SSEC = #{com_ssec}
	   AND SEQ = #{seq}
	   AND DSEQ = #{dseq}
	
]]>
</update> 

<update id="updateAddAct" parameterType="HashMap">
<![CDATA[

	UPDATE TC_ADDACTREQ SET 
	 REMARK =  #{remark}
	 WHERE PLM_NO = #{plm_no}
	   AND COM_SSEC = #{com_ssec}
	   AND SEQ = #{seq}

 ]]>
</update> 

<update id="updateAddActDetail" parameterType="HashMap">
<![CDATA[

	UPDATE TC_ADDACTREQ_DTL SET 
	 TRI_ICD =  #{tri_icd}
	,QTY = #{qty}
	,REQ_AMT = #{req_amt}
	,REQ_SUM_AMT = #{req_sum_amt}
	,TRI_TYPE = #{tri_type}
	,TRI_FAMT = #{tri_famt}
	,TRI_DRATE = #{tri_drate}
	,RATE_SUBJECT = #{rate_subject}
	,STD_AMT = #{std_amt}
	 WHERE PLM_NO = #{plm_no}
	   AND COM_SSEC = #{com_ssec}
	   AND SEQ = #{seq}
	   AND DSEQ = #{dseq}

 ]]>
</update> 

<select id="selectAddActDetail" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPAddActDetail">
<![CDATA[

	SELECT A.PLM_NO
			,A.COM_SSEC
			,A.SEQ
			,A.DSEQ
			,A.TRI_ICD
			,C.TRI_INM
			,A.QTY
			,A.REQ_AMT
			,A.REQ_SUM_AMT
			,A.TRI_TYPE
			,A.TRI_FAMT
			,A.TRI_DRATE
			,ISNULL(A.RATE_SUBJECT, '') RATE_SUBJECT
			,A.STD_AMT
	  FROM TC_ADDACTREQ_DTL A WITH (NOLOCK), TC_ADDACTREQ B, TC_TRINF C WITH(NOLOCK)
	 WHERE A.PLM_NO = B.PLM_NO
	   AND A.COM_SSEC = B.COM_SSEC
	   AND A.SEQ = B.SEQ
	   AND B.COM_AGSEC = C.COM_AGSEC
	   AND B.COM_BRAND = C.COM_BRAND
	   AND B.TRS_SEC = C.TRS_SEC
	   AND A.TRI_ICD = C.TRI_ICD
	   AND A.PLM_NO = #{plm_no}
	   AND A.COM_SSEC = #{com_ssec}
	   AND A.SEQ = #{seq}
	 ORDER BY A.DSEQ

]]> 
</select>
 
<select id="selectAddAct" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPAddAct">
<![CDATA[

	SELECT A.PLM_NO
			,A.COM_SSEC
			,A.SEQ
			,A.COM_AGSEC
			,A.COM_BRAND
			,A.TRS_SEC
			,B.TRS_SNM
			,A.ADDACT_REQDT
			,A.ADDACT_STAT
			,CASE A.ADDACT_STAT WHEN 'C83003' THEN ISNULL(A.REJECT_REASON, '') ELSE '' END AS REJECT_REASON
			,A.REMARK
	  FROM TC_ADDACTREQ A WITH (NOLOCK), TC_TRSEC B WITH(NOLOCK)
	 WHERE A.COM_AGSEC = B.COM_AGSEC
	   AND A.COM_BRAND = B.COM_BRAND
	   AND A.TRS_SEC = B.TRS_SEC
	   AND A.PLM_NO = #{plm_no}
	   AND A.COM_SSEC = #{com_ssec}
	   AND A.SEQ = #{seq}
 
]]> 
</select>
  
<insert id="insertAddAct" parameterType="HashMap">
<![CDATA[
	INSERT TC_ADDACTREQ (
	 PLM_NO
	,COM_SSEC
	,SEQ
	,COM_AGSEC
	,COM_BRAND
	,TRS_SEC
	,ADDACT_REQDT
	,ADDACT_STAT
	,REMARK
	,FST_USR_CD
	,FST_SYS_DT
	,USR_CD
	,SYS_DT
	) VALUES (
	 #{plm_no}
	,#{com_ssec}
	,#{seq}
	,#{com_agsec} -- 등록한 정산분류정보
	,#{com_brand} -- 등록한 정산분류정보
	,#{trs_sec}  -- 등록한 정산분류정보
	,CONVERT(VARCHAR(8), GETDATE(), 112) -- 요청일자
	,'C83001' -- 요청
	,#{remark} -- 비고
	,#{user_id}
	,GETDATE()
	,#{user_id}
	,GETDATE())

]]>
</insert>

<insert id="insertAddActDetailMulti" parameterType="HashMap">
<![CDATA[
	INSERT TC_ADDACTREQ_DTL (
	 PLM_NO
	,COM_SSEC
	,SEQ
	,DSEQ
	,TRI_ICD
	,QTY
	,REQ_AMT
	,REQ_SUM_AMT
	,TRI_TYPE
	,TRI_FAMT
	,TRI_DRATE
	,RATE_SUBJECT
	,STD_AMT
	,FST_USR_CD
	,FST_SYS_DT
	,USR_CD
	,SYS_DT )
    SELECT  #{plm_no}
	       ,#{com_ssec}
	       ,#{seq}
	       ,(SELECT REPLICATE('0',3 - LEN(ISNULL(MAX(DSEQ),0) + 1)) + CAST((ISNULL(MAX(DSEQ),0) + 1) AS VARCHAR)
	           FROM TC_ADDACTREQ_DTL WITH (NOLOCK)
	       	  WHERE PLM_NO = #{plm_no}
	       	    AND COM_SSEC = #{com_ssec}
	       	    AND SEQ = #{seq})
	       ,A.DATA AS TRI_ICD
	       ,B.DATA AS QTY
	       ,C.DATA AS REQ_AMT
	       ,D.DATA AS REQ_SUM_AMT
	       ,E.DATA AS TRI_TYPE
	       ,F.DATA AS TRI_FAMT
	       ,G.DATA AS TRI_DRATE
	       ,H.DATA AS RATE_SUBJECT
	       ,I.DATA AS STD_AMT
	       ,#{user_id}
	       ,GETDATE()
	       ,#{user_id}
	       ,GETDATE()
	  FROM dbo.fnSplit(#{tri_icd_arr}) A, dbo.fnSplit(#{qty_arr}) B, dbo.fnSplit(#{req_amt_arr}) C, dbo.fnSplit(#{req_sum_amt_arr}) D, dbo.fnSplit(#{tri_type_arr}) E,
	       dbo.fnSplit(#{tri_famt_arr}) F, dbo.fnSplit(#{tri_drate_arr}) G, dbo.fnSplit(#{rate_subject_arr}) H, dbo.fnSplit(#{std_amt_arr}) I
	 WHERE A.SEQNO = B.SEQNO
	   AND A.SEQNO = C.SEQNO
	   AND A.SEQNO = D.SEQNO
	   AND A.SEQNO = E.SEQNO
	   AND A.SEQNO = F.SEQNO
	   AND A.SEQNO = G.SEQNO
	   AND A.SEQNO = H.SEQNO
	   AND A.SEQNO = I.SEQNO
]]>
</insert>
 
<insert id="insertAddActDetail" parameterType="HashMap">
<![CDATA[
	INSERT TC_ADDACTREQ_DTL (
	 PLM_NO
	,COM_SSEC
	,SEQ
	,DSEQ
	,TRI_ICD
	,QTY
	,REQ_AMT
	,REQ_SUM_AMT
	,TRI_TYPE
	,TRI_FAMT
	,TRI_DRATE
	,RATE_SUBJECT
	,STD_AMT
	,FST_USR_CD
	,FST_SYS_DT
	,USR_CD
	,SYS_DT
	) VALUES (
	 #{plm_no}
	,#{com_ssec}
	,#{seq}
	,#{dseq}
	,#{tri_icd} -- 정산품목 코드
	,#{qty} -- 요청수량
	,#{req_amt} -- 요청단가
	,#{req_sum_amt} -- 품목 * 단가
	,#{tri_type} -- 품목의 정산유형
	,#{tri_famt} -- 품목의 정산단가 (정산유형이 '정액'일 경우)
	,#{tri_drate} -- 품목의 지급요율 (정산유형이 '요율'일 경우)
	,#{rate_subject} -- 품목의 요율산정대상 (정산유형이 '요율'일 경우)
	,CASE #{tri_type} WHEN 'C84002' THEN NULL ELSE #{std_amt} END -- 정산기준금액(소바자가일경우 TO_ORDDET SUM(IOP_SALCST_REC*ORD_QTY), 공장도가일 경우(IOP_MNFCST)) (정산유형이 '요율'일 경우)
	,#{user_id}
	,GETDATE()
	,#{user_id}
	,GETDATE())
 
]]> 
</insert>

<select id="selectAddActDetailSeq" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[

	SELECT REPLICATE('0',3 - LEN(ISNULL(MAX(DSEQ),0) + 1)) + CAST((ISNULL(MAX(DSEQ),0) + 1) AS VARCHAR) AS DATA1
	  FROM TC_ADDACTREQ_DTL WITH (NOLOCK)
	 WHERE PLM_NO = #{plm_no}
	   AND COM_SSEC = #{com_ssec}
	   AND SEQ = #{seq}

]]> 
</select>

<select id="selectAddActSeq" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[

	SELECT REPLICATE('0',3 - LEN(ISNULL(MAX(SEQ),0) + 1)) + CAST((ISNULL(MAX(SEQ),0) + 1) AS VARCHAR) AS DATA1
	  FROM TC_ADDACTREQ WITH (NOLOCK)
	 WHERE PLM_NO = #{plm_no}
	   AND COM_SSEC =  #{com_ssec}

]]>
</select> 
 
<select id="selectActItemList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPTrinfList">
<![CDATA[
	SELECT TRS_SEC, TRI_ICD, TRI_INM, TRI_TYPE, ISNULL(RATE_SUBJECT, '') RATE_SUBJECT, TRI_DRATE,
	       CASE TRI_TYPE WHEN  'C84001' THEN 
	       (CASE RATE_SUBJECT WHEN 'C85001' THEN CASE (SELECT ISNULL(SUM(IOP_SALCST_REC*ORD_QTY), -8888) FROM TO_ORDDET WITH(NOLOCK) WHERE ORM_NO = #{orm_no}) WHEN -8888 THEN -9999
	                                             ELSE ROUND((SELECT ISNULL(SUM(IOP_SALCST_REC*ORD_QTY), -8888) FROM TO_ORDDET WITH(NOLOCK) WHERE ORM_NO = #{orm_no}) * TRI_DRATE/100, -1, 1) END
	                          WHEN 'C85002' THEN CASE (SELECT ISNULL(SUM(IOP_MNFCST*ORD_QTY), -8888) FROM TO_ORDDET WITH(NOLOCK) WHERE ORM_NO = #{orm_no}) WHEN -8888 THEN -9999
	                                             ELSE ROUND((SELECT ISNULL(SUM(IOP_MNFCST*ORD_QTY), -8888) FROM TO_ORDDET WITH(NOLOCK) WHERE ORM_NO = #{orm_no}) * TRI_DRATE/100, -1, 1) END
	                          ELSE '0'END )-- 
	                          WHEN 'C84002' THEN TRI_FAMT -- 금액
	                          ELSE 0
	                          END AS TRI_AMT,
	       CASE TRI_TYPE WHEN  'C84001' THEN 
	       (CASE RATE_SUBJECT WHEN 'C85001' THEN CASE (SELECT ISNULL(SUM(IOP_SALCST_REC*ORD_QTY), -8888) FROM TO_ORDDET WITH(NOLOCK) WHERE ORM_NO = #{orm_no} ) WHEN -8888 THEN -9999
	                                             ELSE (SELECT ISNULL(SUM(IOP_SALCST_REC*ORD_QTY), -8888) FROM TO_ORDDET WITH(NOLOCK) WHERE ORM_NO = #{orm_no} ) END
	                          WHEN 'C85002' THEN CASE (SELECT ISNULL(SUM(IOP_MNFCST*ORD_QTY), -8888) FROM TO_ORDDET WITH(NOLOCK) WHERE ORM_NO = #{orm_no} ) WHEN -8888 THEN -9999
	                                             ELSE (SELECT ISNULL(SUM(IOP_MNFCST*ORD_QTY), -8888) FROM TO_ORDDET WITH(NOLOCK) WHERE ORM_NO = #{orm_no} ) END
	                          ELSE '0'END )-- 
	                          WHEN 'C84002' THEN TRI_FAMT -- 금액
	                          ELSE 0
	                          END AS STD_AMT	                          
	  FROM TC_TRINF WITH(NOLOCK)
	 WHERE COM_AGSEC = #{com_agsec}
	   AND COM_BRAND = #{com_brand}
	   AND TRS_SEC = #{trs_sec}
	   AND TRI_INM LIKE #{tri_inm}
	   AND USE_YN = 'Y'
	 ORDER BY TRI_INM
	 
	 		
]]>
</select>  
     
<select id="selectActItemList_" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPTrinfList">
<![CDATA[
 
	SELECT TRS_SEC, TRI_ICD, TRI_INM, TRI_TYPE, RATE_SUBJECT, TRI_DRATE,  
	       CASE TRI_TYPE WHEN  'C84001' THEN (CASE RATE_SUBJECT WHEN 'C85001' THEN TRI_DRATE * (SELECT SUM(ISNULL(IOP_SALCST,0)) FROM TO_ORDDET WHERE ORM_NO = #{orm_no}) 
		                                                        WHEN 'C85002' THEN TRI_DRATE * (SELECT SUM(ISNULL(IOP_MNFCST,0)) FROM TO_ORDDET WHERE ORM_NO = #{orm_no}) ELSE '0' END)
	                     WHEN  'C84002' THEN TRI_FAMT ELSE 0 END AS TRI_AMT
	  FROM TC_TRINF WITH(NOLOCK)
	 WHERE COM_AGSEC = #{com_agsec}
	   AND COM_BRAND = #{com_brand}
	   AND TRS_SEC = #{trs_sec}
	   AND TRI_INM LIKE #{tri_inm}
	   AND USE_YN = 'Y'
	 ORDER BY TRI_INM
   
]]>
</select> 

<select id="selectTrsecList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPTtComcd">
<![CDATA[

	SELECT A.TRS_SNM AS CCD_CD, A.TRS_SEC AS CCD_NM 
	  FROM TC_TRSEC A WITH(NOLOCK) INNER JOIN TT_COMCD C WITH(NOLOCK) ON A.GUBUN = C.CCD_CD
	 WHERE A.COM_AGSEC = #{com_agsec}
	   AND A.COM_BRAND = #{com_brand}
	   AND A.USE_YN = 'Y'
	   AND C.REF_1 = 'Y'
	 ORDER BY A.TRS_SNM
  
]]>
</select>

<select id="selectAddActList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPAddActList">
<![CDATA[
  
	SELECT R.SEQ,
	       T.TRS_SEC,
	       T.TRS_SNM,
	       SUM(D.REQ_SUM_AMT) AS AMT,
	       ADDACT_STAT,
		   X.CCD_NM ADDACT_STAT_NM
	  FROM TC_ADDACTREQ R WITH (NOLOCK) INNER JOIN TC_ADDACTREQ_DTL D WITH (NOLOCK) ON R.PLM_NO = D.PLM_NO AND R.COM_SSEC = D.COM_SSEC AND R.SEQ = D.SEQ
	                                    INNER JOIN TC_TRSEC T WITH (NOLOCK) ON R.COM_AGSEC = T.COM_AGSEC AND R.COM_BRAND = T.COM_BRAND AND R.TRS_SEC = T.TRS_SEC
	                                    INNER JOIN TT_COMCD X WITH(NOLOCK) ON R.ADDACT_STAT = X.CCD_CD
	 WHERE R.PLM_NO = #{plm_no} 
	   AND R.COM_SSEC = #{com_ssec}
	   AND R.ADDACT_STAT NOT IN ('C83004')
	 GROUP BY R.SEQ, T.TRS_SEC, T.TRS_SNM, ADDACT_STAT, X.CCD_NM
	 ORDER BY R.SEQ DESC 
 
]]>
</select>
   
 <select id="selectNotSendCtm" parameterType="java.lang.String" resultType="Integer">
<![CDATA[
 	SELECT COUNT(*) AS CNT
 		FROM   TA_HC_NOTSENDCTM Z with (nolock)
	    WHERE  Z.CTM_TEL = #{ctm_hp}
	    AND Z.APPLY_YN = 'Y'	    
]]>
</select>
  
 <select id="selectHappyCallSendCheck" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[
	 SELECT TOP 1
	        A.COM_CMP AS DATA1
	   FROM TA_HCSENDD A WITH (NOLOCK)
      WHERE A.COM_CMP = #{companyCd}
	    AND A.COM_AGSEC = #{com_agsec}
	    AND A.COM_SSEC = #{com_ssec}
	    AND A.SEND_SEQ = #{send_seq}
	    AND A.PLM_NO = #{plm_no}
	    
]]>
</select>
  
<insert id="insertHappyCallAnswer" parameterType="HashMap">
<![CDATA[
	INSERT INTO TA_HC_ANSWERMST (
	       COM_CMP,
	       COM_AGSEC,
	       COM_SSEC,
	       CLIENT_SSEC,
	       PLM_NO,
	       RPT_SEQ,
	       CTM_URL_KEY,
	       CALL_GUBUN,
	       STI_CD,
	       COM_CTSEC,
	       COM_SCD,
	       AGT_CD,
	       PLM_CDT,
	       ORM_NO,
	       ORM_NM,
	       ORM_GADDR,
	       ORM_AMT,
	       PROCESS_CD,
	       USR_CD,
	       SYS_DT,
	       FST_USR,
	       FST_SYS_DT) 
	 SELECT A.COM_CMP,
	        A.COM_AGSEC,
	        A.COM_SSEC,
	        A.CLIENT_SSEC,
	        A.PLM_NO,
	        CASE WHEN A.COM_SSEC = 'C18A' THEN A.RPT_SEQ ELSE B.REM_SEQ END AS RPT_SEQ,
	        A.CTM_URL_KEY,
	        'A92002' AS CALL_GUBUN,
	        B.STI_CD,
	        B.COM_CTSEC,
	        B.COM_SCD,
	        B.AGT_CD,
	        B.REM_DT,
	        B.ORM_NO,
	        B.ORM_NM,
	        (SELECT CTM_ADDR FROM TT_CUSTOM WHERE CTM_CD = B.ORM_PURCST) AS CUST_ADDR,
	        B.ORM_AMT,
	        #{process_cd},
	        #{sti_cd},
	        GETDATE(),
	        #{sti_cd},
	        GETDATE()
	   FROM TA_HCSENDD A WITH (NOLOCK), TC_RESMST B WITH (NOLOCK)
	  WHERE A.COM_CMP = #{companyCd}
	    AND A.COM_AGSEC = #{com_agsec}
	    AND A.COM_SSEC = #{com_ssec}
	    AND A.CLIENT_SSEC = #{client_ssec}
	    AND A.SEND_SEQ = #{send_seq}
	    AND A.PLM_NO = B.PLM_NO
	    AND A.COM_SSEC = B.COM_SSEC
	    AND B.REM_DT = #{rem_dt}
	    AND B.REM_SEQ = #{rem_seq}

]]>
</insert>
 
<insert id="insertHappyCallDetail" parameterType="HashMap">
<selectKey keyProperty="ctm_url_key" resultType="Integer" order="AFTER"> 
	SELECT IDENT_CURRENT('TA_HCSENDD')
</selectKey>
<![CDATA[
	INSERT INTO TA_HCSENDD (
	       COM_CMP,
	       COM_AGSEC,
	       COM_SSEC,
	       CLIENT_SSEC,
	       SEND_SEQ,
	       CTM_CD,
	       CTM_HP,
	       PLM_NO,
	       RPT_NO,
	       RPT_SEQ,
	       SEND_YN,
	       SEND_USR,
	       SEND_TM)
	 VALUES (
	       #{companyCd},
	       #{com_agsec},
	       #{com_ssec},
	       #{client_ssec},
	       #{send_seq},
	       #{orm_purcst},
	       #{ctm_hp},
	       #{plm_no},
	       #{rpt_no},
	       #{rpt_seq},
	       'Y',
	       #{sti_cd},
	       GETDATE())

]]>
</insert>

<insert id="insertHappyCallMaster" parameterType="HashMap">
<selectKey keyProperty="send_seq" resultType="Integer" order="AFTER"> 
	SELECT IDENT_CURRENT('TA_HCSENDM')
</selectKey>
<![CDATA[
	INSERT INTO TA_HCSENDM (
           COM_CMP,
           COM_AGSEC,
           COM_SSEC,
           CLIENT_SSEC,
           QUEST_SEQ,
           SEND_TITLE,
           RESV_YN,
           RESV_TM,
           SEND_TM,
           MSG_GUBUN_CD,
           SEND_TXT1,
           SEND_TXT2,
           SEND_TXT3,
           SEND_CNT,
           SEND_USR,
           DIST_CD,
           FST_USR,
           FST_SYS_DT )
	VALUES (
           #{companyCd},
           #{com_agsec},
           #{com_ssec},
           #{client_ssec},
           #{quest_seq},
           #{send_title},
           #{resv_yn},
           '1900-01-01 01:00:00.000',
           GETDATE(),
           #{msg_gubun_cd},
           #{biztalkmessage},
           #{message},
           #{attachmentUrl},
           1,
           #{sti_cd},
           #{dist_cd},
           #{sti_cd},
           GETDATE() )

]]>
</insert>

<update id="updateHappyCallCount" parameterType="HashMap">
<![CDATA[

	UPDATE TA_HCSENDM SET 
	       SEND_TM = GETDATE(),
	       SEND_CNT = (SELECT COUNT(*)
	                     FROM TA_HCSENDD
	                    WHERE COM_CMP = #{companyCd}
	                      AND COM_AGSEC = #{com_agsec}
	                      AND COM_SSEC = #{com_ssec}
	                      AND CLIENT_SSEC = #{client_ssec}
	                      AND SEND_SEQ = #{send_seq}
	                      AND SEND_YN = 'Y'),
	       SEND_USR = #{sti_cd} 
	 WHERE COM_CMP = #{companyCd}
	   AND COM_AGSEC = #{com_agsec}
	   AND COM_SSEC = #{com_ssec}
	   AND CLIENT_SSEC = #{client_ssec}
	   AND SEND_SEQ = #{send_seq}
 
 ]]>
</update> 

 <select id="selectHappyCallMessage" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPHappyCall">
<![CDATA[
  
	SELECT RMK1 AS BIZTALKMESSAGE, RMK2 AS MESSAGE, RMK3 AS ATTACHMENTURL,
       (SELECT Z.CCD_NM FROM TT_COMCD Z with (nolock) WHERE Z.CDX_CD = 'C02' AND Z.CCD_CD = #{com_agsec}) AS FROMNM,
	   (SELECT Z.REF_1 FROM TT_COMCD Z with (nolock) WHERE Z.CDX_CD = 'C02' AND Z.CCD_CD = #{com_agsec}) AS FROMNO,
	   ISNULL((SELECT CASE C.CTM_TYPE WHEN 'C' THEN 'A6002' ELSE 'A6001' END FROM TT_CUSTOM C WITH (NOLOCK) INNER JOIN TC_RESMST R WITH (NOLOCK) ON C.CTM_CD = R.ORM_PURCST WHERE R.PLM_NO = #{plm_no}), '') AS CLIENT_SSEC,
	   (SELECT ISNULL(MAX(M.SEND_SEQ), 0) FROM TC_RESMST R WITH (NOLOCK) INNER JOIN TA_HCSENDM M WITH (NOLOCK) ON M.COM_AGSEC = R.COM_AGSEC AND M.COM_SSEC = R.COM_SSEC WHERE R.PLM_NO = #{plm_no} AND M.COM_CMP = #{companyCd} AND M.DIST_CD = #{dist_cd} AND M.CLIENT_SSEC = (SELECT CASE C.CTM_TYPE WHEN 'C' THEN 'A6002' ELSE 'A6001' END FROM TT_CUSTOM C WITH (NOLOCK) INNER JOIN TC_RESMST R WITH (NOLOCK) ON C.CTM_CD = R.ORM_PURCST WHERE R.PLM_NO = #{plm_no}) ) AS SEND_SEQ,
	   ISNULL((SELECT ORM_PURCST FROM TC_RESMST WITH (NOLOCK) WHERE REM_DT = #{rem_dt} AND REM_SEQ = #{rem_seq}), '') AS ORM_PURCST,
	   (CASE #{com_ssec} WHEN 'C18C' THEN (SELECT PLM_CDT FROM TC_PLANMST WITH (NOLOCK) WHERE PLM_NO = #{plm_no})
	                                 ELSE (SELECT RPT_ENDDT FROM TA_RPTREQ WITH (NOLOCK) WHERE RPT_NO = #{rpt_no} AND RPT_SEQ = #{rpt_seq}) END) AS SEND_DT,
	   RMK4 AS ATTACHMENTNAME,
	   TEMPLATE_CODE AS TEMPLATECODE
       FROM   TC_SMSM A  with (nolock)
       WHERE  1 = 1
       AND    COM_AGSEC  = #{com_agsec}
       AND	  COM_BRAND  = #{com_brand}
       AND    SOT_CD  = #{sot_cd}
       AND    B_CH_CD  = 'C63002'
       AND    B_TAR_CD  = 'C64003'
       AND B_GUBUN_CD IN (SELECT CCD_CD
                          FROM   TT_COMCD WITH (NOLOCK)
                          WHERE  CDX_CD = 'C62'
                             AND REF_1 = 'A'
                             AND REF_2 = 'HAPPYCALL')
	    
]]>
</select>
   
 <insert id="erp_sigongDelivery" parameterType="HashMap">
<![CDATA[
	INSERT INTO TC_STIDUEDAY (SCH_DAY, COM_SCD, STI_CD, STI_NM, STI_QTYCAPA, STI_AMTCAPA, STI_CURRENTQTY, STI_CURRENTAMT, STI_DUEDAY, USR_CD, SYS_DT, FST_USR, FST_SYS_DT )
	SELECT
		CONVERT(VARCHAR(8), GETDATE(), 112) AS SCHEDULE_DAY,
		AAA.COM_SCD,
		AAA.STI_CD,
		ISNULL(AAA.STI_NM, ''),
		ISNULL(AAA.STI_QTYCAPA, 0),
		ISNULL(AAA.STI_AMTCAPA, 0),
		ISNULL(AAA.QTY0, 0),
		ISNULL(AAA.AMT0, 0),
		( CASE WHEN ISNULL(AAA.QTY_DUEDAY, 0) >= ISNULL(AAA.AMT_DUEDAY, 0) THEN ISNULL(AAA.QTY_DUEDAY, 0) ELSE ISNULL(AAA.AMT_DUEDAY, 0) END ) AS FINAL_DUEDAY,
		'MOBILECM',
		GETDATE(),
		'MOBILECM',
		GETDATE()
	FROM 
	(
		SELECT
			AA.COM_SCD,
			AA.STI_CD,
			AA.STI_NM,
			AA.STI_QTYCAPA,
			AA.STI_AMTCAPA,
			AA.QTY0,
			AA.AMT0,
			(CASE WHEN AA.STI_QTYCAPA > QTY1 THEN 4 
				  WHEN AA.STI_QTYCAPA > QTY2 THEN 5
				  WHEN AA.STI_QTYCAPA > QTY3 THEN 6
				  WHEN AA.STI_QTYCAPA > QTY4 THEN 7
				  WHEN AA.STI_QTYCAPA > QTY5 THEN 8
				  WHEN AA.STI_QTYCAPA > QTY6 THEN 9
				  WHEN AA.STI_QTYCAPA > QTY7 THEN 10
				  WHEN AA.STI_QTYCAPA > QTY8 THEN 11
				  WHEN AA.STI_QTYCAPA > QTY9 THEN 12
				  WHEN AA.STI_QTYCAPA > QTY10 THEN 13
				  WHEN AA.STI_QTYCAPA > QTY11 THEN 14
				  WHEN AA.STI_QTYCAPA > QTY12 THEN 15
				  WHEN AA.STI_QTYCAPA > QTY13 THEN 16
				  WHEN AA.STI_QTYCAPA > QTY14 THEN 17
				  WHEN AA.STI_QTYCAPA > QTY15 THEN 18
				  ELSE
					 19
				  END ) AS QTY_DUEDAY,
			(CASE WHEN AA.STI_AMTCAPA > AMT1 THEN 4 
				  WHEN AA.STI_AMTCAPA > AMT2 THEN 5
				  WHEN AA.STI_AMTCAPA > AMT3 THEN 6
				  WHEN AA.STI_AMTCAPA > AMT4 THEN 7
				  WHEN AA.STI_AMTCAPA > AMT5 THEN 8
				  WHEN AA.STI_AMTCAPA > AMT6 THEN 9
				  WHEN AA.STI_AMTCAPA > AMT7 THEN 10
				  WHEN AA.STI_AMTCAPA > AMT8 THEN 11
				  WHEN AA.STI_AMTCAPA > AMT9 THEN 12
				  WHEN AA.STI_AMTCAPA > AMT10 THEN 13
				  WHEN AA.STI_AMTCAPA > AMT11 THEN 14
				  WHEN AA.STI_AMTCAPA > AMT12 THEN 15
				  WHEN AA.STI_AMTCAPA > AMT13 THEN 16
				  WHEN AA.STI_AMTCAPA > AMT14 THEN 17
				  WHEN AA.STI_AMTCAPA > AMT15 THEN 18
				  ELSE
					 19
				  END ) AS AMT_DUEDAY
		  FROM (
	
				SELECT
					A.STI_NM,
					A.STI_QTYCAPA,
					A.STI_AMTCAPA,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK), TO_ORDMAS TOO WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.ORM_NO = TOO.ORM_NO
						AND TOO.ORM_STAT <> 'O08003'
						AND CONVERT(CHAR(8), TOO.ORM_ORDDT, 112) = convert(char(8), getdate(), 112) ) AS QTY0,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK), TO_ORDMAS TOO WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.ORM_NO = TOO.ORM_NO
						AND TOO.ORM_STAT <> 'O08003'						
						AND CONVERT(CHAR(8), TOO.ORM_ORDDT, 112) = convert(char(8), getdate(), 112) ) AS AMT0,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 4
					) as DAY1,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 4
										) ) QTY1,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 4
										) ) AMT1,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 5
					) as DAY2,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 5
										)  ) as QTY2,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 5
										)  ) as AMT2,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 6
					) as DAY3,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 6
										) ) as QTY3,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 6
										) ) as AMT3,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 7
					) as DAY4,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 7
										) ) as QTY4,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 7
										) ) as AMT4,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 8
					) as DAY5,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 8
										) ) as QTY5,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 8
										) ) as AMT5,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 9
					) as DAY6,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 9
										) ) as QTY6,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 9
										) ) as AMT6,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 10
					) as DAY7,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 10
										) ) as QTY7,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 10
										) ) as AMT7,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 11
					) as DAY8,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 11
										) ) as QTY8,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 11
										) ) as AMT8,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 12
					) as DAY9,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 12
										) ) as QTY9,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 12
										) ) as AMT9,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 13
					) as DAY10,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 13
										) ) as QTY10,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 13
										) ) as AMT10,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 14
					) as DAY11,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 14
										) ) as QTY11,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 14
										) ) as AMT11,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 15
					) as DAY12,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 15
										) ) as QTY12,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 15
										) ) as AMT12,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 16
					) as DAY13,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 16
										) ) as QTY13,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 16
										) ) as AMT13,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 17
					) as DAY14,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 17
										) ) as QTY14,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 17
										) ) as AMT14,
					(
						SELECT
							A.CAL_YMD
						FROM (
							SELECT
								ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
								CAL_YMD
							FROM TT_CALENDAR TTC WITH (NOLOCK)
							WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
							  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
							  AND TTC.CAL_SEC = 'T33N'
						) A
						where A.NUM = 18
					) as DAY15,
					(SELECT COUNT(*)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 18
										) ) as QTY15,
					(SELECT SUM(TCR.ORM_AMT)
					   FROM TC_RESMST TCR WITH (NOLOCK)
					  WHERE TCR.STI_CD = A.STI_CD
						AND TCR.COM_SCD = A.COM_SCD
						AND TCR.COM_SSEC = 'C18C'
						AND TCR.REM_DT = (
											SELECT
												A.CAL_YMD
											FROM (
												SELECT
													ROW_NUMBER() OVER(ORDER BY CAL_YMD ASC) AS NUM,
													CAL_YMD
												FROM TT_CALENDAR TTC WITH (NOLOCK)
												WHERE TTC.COM_CMP = 'T01I' AND TTC.COM_CSEC = 'T32001' -- AND CAL_SEC = 'T33N'
												  AND TTC.CAL_YMD >= DATEADD(DAY, 1, CONVERT(CHAR(8), GETDATE(), 112) )
												  AND TTC.CAL_SEC = 'T33N'
											) A
											where A.NUM = 18
										) ) as AMT15,
					A.STI_CD,
					A.COM_SCD
				  FROM TC_STINF A WITH (NOLOCK)
				 WHERE A.STI_RANK = 'Y'
				   AND EXISTS 
							(SELECT  1
							FROM    TC_TOWND B WITH (NOLOCK)
							WHERE   B.STI_CD = A.STI_CD )
			) AA
		) AAA

]]>
</insert>

 <select id="erp_selectAsItemReport" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPAsItemReport">
<![CDATA[
	SELECT  A.BMT_ITEM,   
	             A.COL_CD,   
	             B.BMT_NM AS BMT_NM,   
	             A.COM_RPFTYP,   
	             A.AST_ACTQTY,   
	             (SELECT CCD_NM FROM TT_COMCD WHERE CCD_CD = A.COM_SPYCOD ) AS COM_SPYCOD,   
	             A.BMT_SAMT,   
	            (CASE WHEN LEN(A.VND_CD) = 3 THEN
	            (SELECT WHS_NM FROM TW_WHSMAS with (nolock) WHERE WHS_CD = A.VND_CD) ELSE
	            (SELECT VND_NM FROM TT_VENDOR with (nolock) WHERE VND_CD = A.VND_CD) END) VND_CD,
	            (SELECT CCD_NM FROM TT_COMCD with (nolock) WHERE CDX_CD = 'A65'   AND CCD_CD=A.DEFECT_GUBUN) AS DEFECT_GUBUN ,
	            (SELECT CCD_NM FROM TT_COMCD with (nolock) WHERE CDX_CD = 'A66'   AND CCD_CD=A.DEFECT_TYP) AS DEFECT_TYP
	            ,D.MOB_USEYN
	            ,D.MOB_NOTUSEQTY
	            ,D.MOB_REMARK
	 FROM  TA_ASTITEM A with (nolock)
	              LEFT OUTER JOIN TA_PLANDTL D WITH (NOLOCK)
	              ON D.PLM_NO = #{orm_no}
	              AND D.BMT_ITEM = A.BMT_ITEM
	              AND D.COL_CD = A.COL_CD,
	              TT_BOMMST B with (nolock)
	WHERE A.RPT_NO     =  SUBSTRING(#{orm_no} /*orm_no*/ , 1, 13)
	     AND A.RPT_SEQ    = '01'
	     AND A.BMT_ITEM   = B.BMT_ITEM 
	     AND A.COL_CD     = B.COL_CD   

]]>
</select> 
  
<select id="erp_selectAsReport" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPAsReport">
<![CDATA[

	SELECT   A.RPT_NO+A.RPT_SEQ AS RPT_NO,     
	         B.VND_NM AS VND_NM,
	         B.VND_TELNO,
             (CASE WHEN LEFT(A.RPT_NO,1) = 'I' THEN A.CTM_NM + ' 님' ELSE A.CTM_NM END)AS CTM_NM, 
              (SELECT TOP 1 ZIP_PROV + ' ' + ZIP_CITY + ' ' + ZIP_TOWN FROM TC_ROADZIP with (nolock) WHERE BDONG_CD =  TOWN_CD )  AS  CTM_ADDR,   
              A.RPT_USRNM,   
              A.RPT_DT,   
              A.RPT_DESC,  
              A.RPT_DESCPLUS, 
              A.RPT_ENDDT,
              A.RPT_QDT,
             (SELECT CCD_NM FROM TT_COMCD with (nolock) WHERE CCD_CD = A.COM_SCD) COM_SCD_NM,
             (SELECT STI_NM FROM TC_STINF with (nolock) WHERE STI_CD = A.STI_CD AND COM_SCD = A.COM_SCD) STI_NM,
         (SELECT TOP 1 ISNULL(MOB_REMARK, '') FROM TA_PLANMST WHERE RPT_NO = A.RPT_NO AND RPT_SEQ = A.RPT_SEQ AND PLM_CDT = A.RPT_ENDDT) AS MOB_REMARK
         FROM TA_RPTREQ A with (nolock),
                    TT_VENDOR B with (nolock)
     WHERE   A.RPT_NO > '' 
          AND  A.RPT_SEQ > ''
          AND  A.VND_SCD = B.VND_CD
          AND  A.RPT_NO + A.RPT_SEQ = #{orm_no}
          AND  CONVERT(NUMERIC,SUBSTRING(A.COM_SPROG,4,3)) >=2
     ORDER BY A.STI_CD
	    
]]>
</select>
 
<select id="erp_selectSigongItemReport" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPSigongItemReport">
<![CDATA[
	SELECT 
                CASE WHEN C.COM_PLDSEC = 'C091' THEN (SELECT AA.WHS_NM FROM TW_WHSMAS AA with (nolock) WHERE C.ITM_STCCD = AA.WHS_CD)
                      WHEN C.COM_PLDSEC = 'C092' THEN C.ITM_STCCD
                      WHEN C.COM_PLDSEC = 'C095' THEN C.ITM_STCCD
                      WHEN C.COM_PLDSEC = 'C096' THEN C.ITM_STCCD
                      WHEN C.COM_PLDSEC = 'C093' THEN (SELECT BB.FES_SNM FROM TC_FESEC BB with (nolock) JOIN TC_FEINF CC with (nolock)  ON BB.FES_SEC = CC.FES_SEC 
                                                                                                                                       AND BB.COM_AGSEC = CC.COM_AGSEC 
                                                                                                        JOIN TT_ITMMST DD with (nolock) ON DD.ITM_CD = CC.ITM_CD
                                                                                                                                       AND DD.COL_CD = CC.COL_CD      
                                                                                                       WHERE 1=1
                                                                                                         AND CC.FEI_CD  = C.ITM_CD
                                                                                                         AND CC.FES_SEC = C.TRS_SEC )
                      WHEN C.COM_PLDSEC IN ('C094','C09A') THEN (SELECT EE.TRS_SNM FROM TC_TRSEC EE with (nolock) JOIN TC_TRINF FF with (nolock) ON EE.TRS_SEC   = FF.TRS_SEC
                                                                                                                                                AND EE.COM_BRAND = FF.COM_BRAND
                                                                                                                 WHERE 1=1
                                                                                                                   AND A.COM_AGSEC = EE.COM_AGSEC
                                                                                                                   AND A.COM_AGSEC = FF.COM_AGSEC
                                                                                                                   AND EE.COM_BRAND  = A.COM_BRAND
                                                                                                                   AND (C.ITM_CD = FF.TRI_ICD or  C.ITM_CD = FF.TRI_ICD_O))
                      WHEN C.COM_PLDSEC = 'C090' THEN C.SET_CD 
                END AS SET_CD
                ,C.ITM_CD 
                ,C.COL_CD 
                ,CASE WHEN A.COM_RMFG = 'C13N' THEN C.PLD_EQTY ELSE C.PLD_FQTY END PLD_FQTY /*201116. 유은향님 요청으로 미결시 요청수량 나오게함. 금액은 상관없다고함. 변경전. ,C.PLD_FQTY */
                ,CASE WHEN C.COM_PLDSEC = 'C090' AND  SUBSTRING(C.PLM_NO, 1, 1) = 'F'  THEN C.PLD_CUSAMT * 1.1 
                      WHEN C.COM_PLDSEC = 'C090' AND  SUBSTRING(C.PLM_NO, 1, 1) != 'F' THEN C.PLD_CUSAMT
                      WHEN C.COM_PLDSEC = 'C091' THEN C.PLD_CUSAMT
                      WHEN C.COM_PLDSEC = 'C092' THEN C.PLD_CUSAMT
                      WHEN C.COM_PLDSEC = 'C095' THEN C.PLD_CUSAMT
                      WHEN C.COM_PLDSEC = 'C096' THEN C.PLD_CUSAMT
                      WHEN C.COM_PLDSEC = 'C093' THEN C.PLD_FAMT
                      WHEN C.COM_PLDSEC IN ('C094','C09A') AND SUBSTRING(C.PLM_NO, 1, 1) = 'I' 
                                                           AND C.ITM_CD IN ( 'D254', 'D255', 'D256', 'D257', 'D258', 'D020', 'D021', 'D022', 'D023',
                                                                             'D024', 'D025', 'D026', 'D027', 'D028', 'D029', 'D030', 'D031', 'D032', 
                                                                             'D041', 'D042', 'D043', 'D044', 'D045', 'D046', 'D047', 'D048', 'D049', 
                                                                             'D050', 'D054', 'D055', 'D056', 'D057', 'D058', 'D059', 'D060', 'D061',
                                                                             'D062', 'D063' ) THEN ROUND(ISNULL(C.PLD_FAMT, 0) * 1.1, -1)
                      WHEN C.COM_PLDSEC IN ('C094','C09A') AND SUBSTRING(C.PLM_NO, 1, 1) = 'I' 
                                                           AND C.ITM_CD NOT IN ( 'D254', 'D255', 'D256', 'D257', 'D258', 'D020', 'D021', 'D022', 'D023',
                                                                                 'D024', 'D025', 'D026', 'D027', 'D028', 'D029', 'D030', 'D031', 'D032', 
                                                                                 'D041', 'D042', 'D043', 'D044', 'D045', 'D046', 'D047', 'D048', 'D049', 
                                                                                 'D050', 'D054', 'D055', 'D056', 'D057', 'D058', 'D059', 'D060', 'D061',
                                                                                 'D062', 'D063' ) THEN ROUND(( ISNULL(C.PLD_FAMT, 0) / 0.8 * 1.1 ), -1)                                                                                        
                      WHEN C.COM_PLDSEC IN ('C094','C09A') AND SUBSTRING(C.PLM_NO, 1, 1) != 'I' THEN 0 
                END AS PLD_FAMT
                ,CASE WHEN C.COM_PLDSEC = 'C090' AND  SUBSTRING(C.PLM_NO, 1, 1) = 'F'  THEN ISNULL(C.PLD_CUSAMT * 1.1,0) * ISNULL(C.PLD_FQTY, 0)   
                      WHEN C.COM_PLDSEC = 'C090' AND  SUBSTRING(C.PLM_NO, 1, 1) != 'F' THEN ISNULL(C.PLD_CUSAMT,0) * ISNULL(C.PLD_FQTY, 0) 
                      WHEN C.COM_PLDSEC = 'C091' THEN ISNULL(C.PLD_CUSAMT, 0) * ISNULL(C.PLD_FQTY, 0)
                      WHEN C.COM_PLDSEC = 'C092' THEN ISNULL(C.PLD_CUSAMT, 0) * ISNULL(C.PLD_FQTY, 0)
                      WHEN C.COM_PLDSEC = 'C095' THEN ISNULL(C.PLD_CUSAMT, 0) * ISNULL(C.PLD_FQTY, 0)
                      WHEN C.COM_PLDSEC = 'C096' THEN ISNULL(C.PLD_CUSAMT, 0) * ISNULL(C.PLD_FQTY, 0)
                      WHEN C.COM_PLDSEC = 'C093' THEN ISNULL(C.PLD_FAMT, 0)   * ISNULL(C.PLD_FQTY, 0)
                      WHEN C.COM_PLDSEC IN ('C094','C09A') AND SUBSTRING(C.PLM_NO, 1, 1) = 'I' 
                                                           AND C.ITM_CD IN ( 'D254', 'D255', 'D256', 'D257', 'D258', 'D020', 'D021', 'D022', 'D023',
                                                                             'D024', 'D025', 'D026', 'D027', 'D028', 'D029', 'D030', 'D031', 'D032', 
                                                                             'D041', 'D042', 'D043', 'D044', 'D045', 'D046', 'D047', 'D048', 'D049', 
                                                                             'D050', 'D054', 'D055', 'D056', 'D057', 'D058', 'D059', 'D060', 'D061',
                                                                             'D062', 'D063' ) THEN ROUND(ISNULL(C.PLD_FAMT, 0) * 1.1, -1) * ISNULL(C.PLD_FQTY, 0) 
                      WHEN C.COM_PLDSEC IN ('C094','C09A') AND SUBSTRING(C.PLM_NO, 1, 1) = 'I' 
                                                           AND C.ITM_CD NOT IN ( 'D254', 'D255', 'D256', 'D257', 'D258', 'D020', 'D021', 'D022', 'D023',
                                                                                 'D024', 'D025', 'D026', 'D027', 'D028', 'D029', 'D030', 'D031', 'D032', 
                                                                                 'D041', 'D042', 'D043', 'D044', 'D045', 'D046', 'D047', 'D048', 'D049', 
                                                                                 'D050', 'D054', 'D055', 'D056', 'D057', 'D058', 'D059', 'D060', 'D061',
                                                                                 'D062', 'D063' ) THEN ROUND(( ISNULL(C.PLD_FAMT, 0) / 0.8 * 1.1 ), -1) * ISNULL(C.PLD_FQTY, 0)                                                                                        
                      WHEN C.COM_PLDSEC IN ('C094','C09A') AND SUBSTRING(C.PLM_NO, 1, 1) != 'I' THEN 0
                END AS PLD_CRAMT
                ,CASE WHEN C.COM_PLDSEC = 'C093' THEN (SELECT CC.FEI_CNM FROM TC_FESEC BB with (nolock) JOIN TC_FEINF CC with (nolock)  ON BB.FES_SEC = CC.FES_SEC 
                                                                                                                                       AND BB.COM_AGSEC = CC.COM_AGSEC 
                                                                                                        JOIN TT_ITMMST DD with (nolock) ON DD.ITM_CD = CC.ITM_CD
                                                                                                                                       AND DD.COL_CD = CC.COL_CD      
                                                                                                       WHERE 1=1
                                                                                                         AND CC.FEI_CD  = C.ITM_CD
                                                                                                         AND CC.FES_SEC = C.TRS_SEC )
                      WHEN C.COM_PLDSEC IN ('C094','C09A') THEN (SELECT FF.TRI_INM FROM TC_TRSEC EE with (nolock) JOIN TC_TRINF FF with (nolock) ON EE.TRS_SEC   = FF.TRS_SEC
                                                                                                                                                AND EE.COM_BRAND = FF.COM_BRAND
                                                                                                                 WHERE 1=1
                                                                                                                   AND A.COM_AGSEC = EE.COM_AGSEC
                                                                                                                   AND A.COM_AGSEC = FF.COM_AGSEC
                                                                                                                   AND EE.COM_BRAND  = A.COM_BRAND
                                                                                                                   AND (C.ITM_CD = FF.TRI_ICD or  C.ITM_CD = FF.TRI_ICD_O))
                      ELSE (SELECT HH.ITM_NM FROM TT_ITMMST HH with (nolock) WHERE HH.ITM_CD = C.ITM_CD AND HH.COL_CD = C.COL_CD)
                END AS ITM_NM
            ,( CASE C.COM_RDSEC WHEN 'C13Y' THEN ( SELECT CCD_NM FROM TT_COMCD WHERE CCD_CD = C.COM_RDSEC ) 
                                WHEN 'C13W' THEN ( SELECT CCD_NM FROM TT_COMCD WHERE CCD_CD = C.COM_RDSEC ) 
                                ELSE ( SELECT CCD_NM FROM TT_COMCD WHERE CCD_CD = C.COM_RDSEC ) + ' / ' + ISNULL(C.MOB_REMARK, '') END ) AS COM_RDSEC
          FROM TC_PLANMST A with (nolock) JOIN TC_PLANDTL C with (nolock) ON 1=1
                                                                         AND C.PLM_NO = A.PLM_NO 
                                                                         AND C.COM_PLDSEC IN ('C090','C091','C092','C095','C096','C093','C094','C09A')      
         WHERE 1=1
             AND A.PLM_NO = #{plm_no}
    ORDER BY A.STI_CD ASC , A.PLM_NO ASC ,A.PLM_FTM ASC, C.COM_PLDSEC ASC, SET_CD
    
]]>
</select>

<select id="erp_selectSigongReport" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPSigongReport">
<![CDATA[

	 SELECT P.ORM_NO, 
	        (SELECT VND_NM 
	         FROM   TT_VENDOR with (nolock) 
	         WHERE  VND_CD = TO_ORDMAS.ORM_REBAGT) AS VND_NM, 
	        P.PLM_CDT, 
	        TO_ORDMAS.ORM_NM, 
	        (SELECT TOP 1 ZIP_PROV + ' ' + ZIP_CITY + ' ' + (CASE WHEN ZIP_TOWN = '' THEN BDONG_NM ELSE ZIP_TOWN END) FROM TC_ROADZIP with (nolock) WHERE BDONG_CD =  P.TOWN_CD )  AS  ORM_GADDR,
	       (SELECT STI_NM FROM TC_STINF with (nolock) WHERE STI_CD = P.STI_CD) AS STI_NM,
	       (SELECT CCD_NM FROM TT_COMCD with (nolock) WHERE CCD_CD = S.COM_SCD) AS COM_SCDNM,
			ISNULL(P.MOB_REMARK, '') + ' ' + ISNULL(( SELECT CASE WHEN MAX(LEFT(COM_UNDSEC,4)) = 'C52A'  THEN '재일정'
															WHEN MAX(LEFT(COM_UNDSEC,4)) = 'C52B'  THEN '반품' 
															WHEN MAX(LEFT(COM_UNDSEC,4)) = 'C52C'  THEN 'AS' 
															ELSE '' END FROM TC_PLANDTL TPD WITH (NOLOCK) WHERE TPD.PLM_NO = P.PLM_NO AND TPD.MOB_STD = 'C13N' ) , '')
			
						+ ' ' + ISNULL(( SELECT CCD_NM FROM TT_COMCD WITH (NOLOCK) WHERE CCD_CD = ( SELECT isnull(MAX(TPD.COM_UNDSEC), '') FROM TC_PLANDTL TPD WITH (NOLOCK) WHERE TPD.PLM_NO = P.PLM_NO AND TPD.MOB_STD = 'C13N' ) ), '') AS MOB_REMARK  
	 FROM   TO_ORDMAS with (nolock) 
	        INNER JOIN TC_PLANMST P with (nolock) 
	                ON TO_ORDMAS.ORM_NO = P.ORM_NO 
	        LEFT OUTER JOIN TT_CUSTOM C1 with (nolock) 
	                     ON TO_ORDMAS.ORM_AGTCST = C1.CTM_CD 
	        LEFT OUTER JOIN TT_CUSTOM C2 with (nolock) 
	                     ON P.ORM_PURCST = C2.CTM_CD 
	        LEFT OUTER JOIN TT_COMCD V2 with (nolock) 
	                     ON TO_ORDMAS.CMP_CD = V2.CCD_CD 
	        LEFT OUTER JOIN TT_USER U1 with (nolock) 
	                     ON P.ORM_SALEMP = U1.USR_CD 
	        LEFT OUTER JOIN TS_CEMPLOYEE U2 with (nolock) 
	                     ON P.ORM_AGTEMP = U2.CEP_CD 
	        INNER JOIN TC_STINF S with (nolock) 
	                ON P.STI_CD = S.STI_CD 
	        INNER JOIN TC_RESMST R with (nolock) 
	                ON R.PLM_NO = P.PLM_NO 
	 WHERE  1=1
	        AND V2.CDX_CD = 'T02' 
	        --AND P.COM_PLMFG >= 'C102' 
	        --AND R.COM_RFG = 'C1412'
	        AND R.COM_SCD = S.COM_SCD
	        AND R.PLM_NO = #{plm_no}
	 ORDER  BY P.STI_CD ASC	  
	    
]]>
</select>

<select id="erp_selectDeliveryItemList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPDeliveryItemList">
<![CDATA[
      
	SELECT 
				  AA.COM_SCD_NM
			     ,AA.ITM_CD
			     ,AA.COL_CD
			     ,AA.PLD_FQTY
			     ,AA.STI_NM
			     ,AA.REM_DT
			     ,ISNULL(AA.ORM_NM, '') AS ORM_NM
			      ,ISNULL(AA.SET_CD, '') AS SET_CD
			      ,ISNULL(AA.COL_SCD, '') AS COL_SCD
				  ,AA.ITM_NM
	              ,AA.PLMFTM_NM
	              ,CASE WHEN LEN(ISNULL(AA.ADDR_DTL, '')) = 0 THEN AA.ORM_GADDR ELSE AA.ORM_GADDR + ' ' + AA.ADDR_DTL END ORM_GADDR
	  FROM (
	
	    SELECT       A.STI_CD,
		             A.PLM_FTM,
		             A.ORM_GADDR,
		             A.ADDR_DTL,
					(SELECT CCD_NM FROM TT_COMCD with (nolock) WHERE CDX_CD = 'C41'	AND CCD_CD= A.PLM_FTM) AS 	PLMFTM_NM,
			         A.COM_SCD,
					(SELECT CCD_NM FROM TT_COMCD with (nolock) WHERE CDX_CD = 'C16'	AND CCD_CD= A.COM_SCD) AS 	COM_SCD_NM,
			         B.ITM_CD,
			         B.COL_CD,
			         SUM(B.PLD_FQTY) AS PLD_FQTY,
			         C.STI_NM,
			         E.REM_DT,
			         E.ORM_NO,
			         E.ORM_NM,
			         A.AGT_CD,
					(SELECT VND_NM FROM TT_VENDOR with (nolock) WHERE A.AGT_CD = VND_CD) AS VND_NM,	
			         B.SET_CD,
			         B.COL_SCD,
			         B.COM_STKSEC,
					 (SELECT CCD_NM FROM TT_COMCD with (nolock) WHERE CDX_CD='T34' AND CCD_CD = B.COM_STKSEC) AS COM_STKSEC_NM		 ,
			         E.REM_FTM,
					 (SELECT CCD_NM FROM TT_COMCD with (nolock) WHERE CDX_CD='C41' AND CCD_CD = E.REM_FTM) AS REM_FTM_NM,
			         B.COM_PLDSEC,
					 (CASE WHEN B.COM_PLDSEC = 'C092' THEN '매/경'
					             WHEN B.COM_PLDSEC = 'C091' THEN '위탁'
					             WHEN B.COM_PLDSEC = 'C094' THEN '분/설'
					             WHEN B.COM_PLDSEC = 'C096' THEN '반품'
							     WHEN B.COM_PLDSEC = 'C09A' THEN '폐기장'
					 ELSE '' END ) AS 		COM_PLDSECNM,
			         E.REM_CSEC,
				     (SELECT ITM_NM FROM TT_ITMMST with (nolock) WHERE ITM_CD = B.ITM_CD AND COL_CD = B.COL_CD) ITM_NM,
				  	 ( SELECT COM_GOODCD FROM TT_ITMCOP with (nolock) WHERE ITM_CD = B.ITM_CD AND COL_CD = B.COL_CD AND COM_CMP = CASE WHEN A.COM_AGSEC = 'C02F' THEN 'T01F' WHEN A.COM_AGSEC = 'C02I' THEN 'T01I' WHEN A.COM_AGSEC = 'C02P' THEN 'T01P' WHEN A.COM_AGSEC = 'C02T' THEN 'T01T' END) AS COM_GOODCD,
			         '' CHK
	     FROM TC_PLANMST A with (nolock),
			         TC_PLANDTL B with (nolock),
			         TC_STINF C with (nolock),
			         TC_RESMST E with (nolock)
	    WHERE 1=1
			 AND A.PLM_NO = B.PLM_NO
		     AND A.COM_SCD = C.COM_SCD
		     AND A.STI_CD = C.STI_CD
		     AND E.PLM_NO = A.PLM_NO
		     AND E.COM_RFG ='C142'
		     AND E.REM_DT = #{rem_dt}
		     AND A.STI_CD = #{sti_cd}
			 AND B.COM_PLDSEC IN('C090','C091','C092','C094','C096','C095','C09A')
	GROUP BY A.STI_CD,
					   A.COM_SCD,
					   B.COM_PLDSEC,
					   B.ITM_CD,
			           B.COL_CD,
			           C.STI_NM,
			           E.REM_DT,
			           E.ORM_NO,
			           E.ORM_NM,
			           A.AGT_CD,
			           B.SET_CD,
			           B.COL_SCD,
			           B.COM_STKSEC,
			           E.REM_FTM,
			           E.REM_CSEC,
					   A.COM_AGSEC,
					   A.PLM_FTM,
					   A.ORM_GADDR,
					   A.ADDR_DTL
	) AA
	WHERE PLD_FQTY > 0
	ORDER BY   AA.STI_NM,
	                   AA.PLM_FTM,
					   AA.ORM_NM,
				       AA.SET_CD,
				       AA.COL_SCD,
				       AA.ITM_CD,
				       AA.COL_CD
  
]]>
</select>
  
<select id="selectLgsStat" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[

	  SELECT ISNULL(A.LGS_STAT, '') DATA1
	     FROM  TC_PLANMST A WITH (NOLOCK)
	    WHERE  PLM_NO = #{plm_no}
	    
]]>
</select>

<update id="updateDropSpot" parameterType="HashMap">
<![CDATA[
	UPDATE TC_PLANMST
	   SET DROP_SPOT = #{drop_spot},
	       DROP_RMK = #{drop_rmk}
	 WHERE PLM_NO = #{plm_no}
]]>
</update> 

<select id="selectPendencyItemList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPConstructionItemPage">
<![CDATA[

	  SELECT 
	           ISNULL((SELECT TTI.ITM_NM FROM TT_ITMMST TTI WITH (NOLOCK) WHERE TTI.ITM_CD = A.ITM_CD AND TTI.COL_CD = A.COL_CD ), '') AS ITM_NM
		     , ISNULL(ITM_CD, '') AS ITMCD_COL
		     , ISNULL(SET_CD, '') AS SETCD_COL
			 , CASE WHEN PLD_EQTY = PLD_FQTY THEN PLD_FQTY ELSE PLD_EQTY - PLD_FQTY END PLD_FQTY
	     FROM  TC_PLANDTL A WITH (NOLOCK)
	    WHERE  COM_PLDSEC IN('C090','C091','C092','C093','C094','C095','C096','C0930','C09A')
	      AND  COM_RDSEC ='C13N'
	      AND  PLM_NO = #{plm_no}
	 ORDER BY  1

]]>
</select>

<select id="selectPendencyList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPPendencyList">
<![CDATA[

    SELECT DISTINCT
	         '시공' COM_SSEC
		   , COM_BRAND
		   , PLM_NO		/*시공번호PK*/
		   , ORM_NO		/*수주번호*/
		   , ORM_NM
		   , STI_NM
		   , PLM_CDT
		   , PLD_RCDT		/*재일정요청일자*/
		   , DROP_SPOT	/*하차장소*/
		   , DROP_SPOT_NM
		   , DROP_RMK
		   , LGS_STAT		/*입고상태*/
		   , INP_RMK		/*입고특이사항*/
		   , COM_UNDSEC
		   , FILE_CNT
		   ,(CASE WHEN  sum(A) > 0	 THEN 'Y' ELSE '' END ) AS AS_YN
		   ,(CASE WHEN  sum(B) > 0	 THEN 'Y' ELSE '' END ) AS RE_YN
		   ,(CASE WHEN  sum(C) > 0	 THEN 'Y' ELSE '' END ) AS RETURN_YN
		   --,(CASE WHEN  sum(D) > 0	 THEN 'Y' ELSE '' END ) AS D
		   --,(CASE WHEN  sum(E) > 0	 THEN 'Y' ELSE '' END ) AS E
       FROM (SELECT  A.PLM_NO		/*시공번호PK*/
	               , A.ORM_NM		/*수주건명*/
				   , C.PLD_RCDT		/*재일정요청일자*/
				   , A.DROP_SPOT	/*하차장소*/
				   , (SELECT CCD_NM FROM TT_COMCD WITH (NOLOCk) WHERE CDX_CD = 'C77' AND CCD_YN = 'Y' AND CCD_CD = A.DROP_SPOT) AS DROP_SPOT_NM
				   , A.DROP_RMK 
				   , (SELECT CCD_NM FROM TT_COMCD WITH (NOLOCk) WHERE CDX_CD = 'C78' AND CCD_YN = 'Y' AND CCD_CD = A.LGS_STAT) AS LGS_STAT		/*입고상태*/
				   , A.INP_RMK		/*입고특이사항*/
				   , (SELECT CCD_NM FROM TT_COMCD WITH (NOLOCk) WHERE CDX_CD = 'C52' AND CCD_YN = 'Y' AND REF_1 = 'C23R' AND CCD_CD = C.COM_UNDSEC) COM_UNDSEC
				   , (SELECT COUNT(ATTCH_FILE_ID) FROM TY_ATTCHFILE WITH(NOLOCK) WHERE ATTCH_FILE_ID = 'proof' + A.PLM_NO AND ATTCH_DIV_CD = 'C') FILE_CNT 
				   , A.ORM_NO		/*수주번호*/
				   , A.PRJ_CD		/*프로젝트번호*/
				   , A.COM_SCD		/*서비스센터코드*/
				   , A.COM_AGSEC	/*회사*/
				   , ( SELECT CCD_NM FROM TT_COMCD WHERE CCD_CD = COM_BRAND ) AS COM_BRAND
				   --, A.COM_BRAND	/*브랜드*/
				   , A.AGT_CD		/*대리점코드*/
				   , A.COM_CTSEC	/*서비스팀구분*/
				   , A.STI_CD		/*시공팀코드*/
				   , A.STM_NO		/*서비스팀원번호*/
				   , A.SAC_CD		/*서비스지역코드*/
				   , A.ORM_ORDDT	/*주문일시*/
				   , A.ORM_RDT		/*요청납기일*/
				   , A.PLM_CDT		/*확정납기일*/
				   , A.PLM_FIXEDT	/*확정종료일*/
				   , A.PLM_ENDDT	/*시공종료일*/
				   , ISNULL(A.ORM_PURCST,'') AS ORM_PURCST	/*구매고객코드*/
				   --, A.ORM_NM		/*수주건명*/
				   , A.ORM_GEMP		/*납품처담당*/
				   , A.DET_CD		/*부서코드*/
				   , A.ORM_GEMPTEL	/*담당전화번호*/
				   , A.ORM_HDPHONE	/*담당HP*/
				   , A.PLM_PTM		/*요청시간*/
				   , A.PLM_FTM		/*확정시간*/
				   , A.PLM_ETM		/*종료시간*/
				   , A.COM_PLMFG	/*진행상태*/
				   , A.ORM_GPOST	/*납품처우편번호*/
				   , A.ORM_GADDR	/*납품처주소*/
				   , A.ORM_GSPC		/*납품처특이사항*/
				   , A.PLM_EVT		/*엘레베이터유뮤*/
				   , A.PLM_CMPYN	/*매장경유유무*/
				   , A.PLM_ITR		/*인테리어공사상태*/
				   , A.ORM_SALEMP	/*본사영업담당사원*/
				   , A.ORM_AGTEMP	/*대리점영업담당사원*/
				   , A.PLM_HCALLYN	/*해피콜유무*/
				   , A.PLM_RMK		/*시공특기사항*/
				   , A.COM_RMFG		/*결과등록상태*/
				   , A.COM_UNMSEC	/*미결사유구분*/
				   , A.ORM_GOOD		/*납품처명*/
				   , C.COM_UNPSEC
				   , C.PLD_RMK
				   , CASE WHEN((SELECT COUNT(*) FROM TC_PLANDTL C WITH (NOLOCK) WHERE C.COM_RDSEC ='C13N' AND C.PLM_NO = A.PLM_NO	 AND ISNULL(C.COM_TDSEC, '') = '' AND ISNULL(C.COM_UNPSEC,'') = '' ) = 0)THEN 1 ELSE 2 END AS COM_UNPEC	/*미결완료구분*/
				   , B.STI_NM		/*시공팀명*/
				   , (SELECT VND_NM FROM TT_VENDOR WITH (NOLOCK) WHERE A.AGT_CD = VND_CD) AS VND_NM		/*대리점이름*/
				   , A.AGT_CD AS VND_CD
				   ,(CASE WHEN COM_UNPSEC= 'C23A' OR (ISNULL(COM_UNPSEC,'') = '' AND PLD_RASDT > 0 ) THEN 1 ELSE 0 END ) AS A
				   ,(CASE WHEN ISNULL(COM_UNPSEC,'') = 'C23R' OR (ISNULL(COM_UNPSEC,'') = '' AND PLD_RCDT > 0 ) THEN 1 ELSE 0 END ) AS B
				   ,(CASE WHEN ISNULL(COM_UNPSEC,'') = 'C23E' OR (ISNULL(COM_UNPSEC,'') = '' AND ISNULL(PLD_RCDT,'') = '' AND ISNULL(PLD_RASDT,'') = '' ) THEN 1 ELSE 0 END ) AS C
 				   ,(CASE WHEN ISNULL(COM_UNPSEC,'') = 'C23T'  THEN 1 ELSE 0 END ) AS D
				   ,(CASE WHEN ISNULL(COM_UNPSEC,'') = 'C23C' OR (PLD_RMK = '시공') THEN 1 ELSE 0 END ) AS E
		   			,A.TOWN_CD /* 2018.03.29 AS접수 필요 파라미터 추가 */
			   FROM  TC_PLANMST A WITH (NOLOCK)
				   , TC_STINF B WITH (NOLOCK)
				   , TC_PLANDTL C WITH (NOLOCK)
			  WHERE  A.COM_PLMFG >='C103'
				AND  A.COM_RMFG ='C13N'
				AND  C.PLM_NO = A.PLM_NO
				/*2018.06.05 |주요한| 폐기장 코드 추가 */
				/*AND  C.COM_PLDSEC IN ('C090','C091','C092','C093','C094','C095','C096','C0930') */
				AND  C.COM_PLDSEC IN ('C090','C091','C092','C093','C094','C095','C096','C0930','C09A')
				AND  C.COM_RDSEC ='C13N'
				AND  A.STI_CD = B.STI_CD
				AND  A.COM_SCD = #{com_scd}
				AND  A.STI_CD = #{sti_cd}
				--AND  C.PLD_RCDT  >= '20211101'
				--AND  C.PLD_RCDT  <= '20211101'
				AND  A.PLM_CDT  >= #{fr_date}
				AND  A.PLM_CDT  <= #{to_date}
				--AND  CASE WHEN((SELECT COUNT(*) FROM TC_PLANDTL C WITH (NOLOCK) WHERE C.COM_RDSEC ='C13N' AND C.PLM_NO = A.PLM_NO	 AND ISNULL(C.COM_TDSEC, '') = '' AND ISNULL(C.COM_UNPSEC,'') = '' ) = 0)THEN 1 ELSE 2 END  = 1
				)A
	 WHERE A.A > 0 OR A.B > 0 OR A.C > 0
   	GROUP BY  COM_BRAND
   	       , PLM_NO		/*시공번호PK*/
		   , ORM_NO		/*수주번호*/
		   , ORM_NM
		   , PLD_RCDT		/*재일정요청일자*/
		   , DROP_SPOT	/*하차장소*/
		   , DROP_SPOT_NM
		   , DROP_RMK
		   , LGS_STAT		/*입고상태*/
		   , INP_RMK		/*입고특이사항*/
		   , STI_NM
		   , PLM_CDT
		   , COM_UNDSEC
		   , FILE_CNT
   ORDER BY  STI_NM
		   , PLM_CDT

]]>

</select>

<update id="finishScheduleHistory" parameterType="HashMap">
<![CDATA[
	UPDATE TT_SCHEDULE_HISTORY
	   SET END_TIME = GETDATE(),
           RESULT = #{result},
           REMARK = #{remark}
	 WHERE SEQ_NO = #{seq_no}
]]>
</update> 

<insert id="startScheduleHistory" parameterType="HashMap">
<selectKey keyProperty="seq_no" resultType="Integer" order="AFTER"> 
	SELECT IDENT_CURRENT('TT_SCHEDULE_HISTORY')
</selectKey>
<![CDATA[
	INSERT INTO TT_SCHEDULE_HISTORY (
           SCHEDULE_SERVER,
           SCHEDULE_ID,
           SCHEDULE_NAME,
           START_TIME,
           END_TIME,
           RESULT,
           REMARK )
	VALUES (
           #{schedule_server},
           #{schedule_id},
           #{schedule_name},
           GETDATE(),
           GETDATE(), 
           #{result},
           #{remark} )

]]>
</insert>

<select id="selectScheduledtFcmNotifyList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPFcmNotify">
<![CDATA[

	 SELECT DISTINCT
	       'mobilecm' AS SEND_FROM_SYSTEM,
	       'mobilecm' AS SEND_TO_SYSTEM,
		   tcr.sti_cd AS COM_SCD,
		   '상차전 반품 등록 내용 알람' AS TITLE,
		   '1)납기: ' + convert(varchar, tcr.rem_dt, 102)
		   + CHAR(13) + CHAR(10) + '2)수주번호: ' + tww.orm_no 
		   + CHAR(13) + CHAR(10) + '3)수주건명: ' + tcr.orm_nm 
		   + CHAR(13) + CHAR(10) + '4)대리점: ' + (select ttv.vnd_nm from tt_vendor ttv where ttv.vnd_cd = tcr.agt_cd ) AS MESSAGE,
		   '' AS USER_ID
	  FROM tw_wtrecpl tww with (nolock), tc_resmst tcr with (nolock)
	 WHERE tww.orm_no = tcr.orm_no
	   AND tcr.com_ssec = 'C18C'
	   AND tww.wtp_finish in ('W510', 'W511', 'W515')
	   AND tcr.rem_dt = CONVERT(CHAR(8), DATEADD(DAY, 1, convert(char(8), getdate(), 112)), 112)
	 ORDER BY tcr.sti_cd

]]>
</select>

<select id="selectNotifyList" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[
	SELECT SEND_TEXT AS DATA1
	  FROM TC_NOTIFY WITH (NOLOCK)
	 WHERE RECEIVE_ID = #{sti_cd}
	   AND SEND_DT >= DATEADD("DAY", -7, GETDATE())
	 ORDER BY SEND_DT DESC

]]>
</select> 
  
<insert id="insertSigonWorkTimeOverAcc" parameterType="HashMap">
<![CDATA[
	INSERT INTO TC_ACTLIST (
		PLM_NO,
		COM_ASEC,
		COM_ACD,
		COM_SVND,
		COM_AGSEC,
		COM_DPSEC,
		ACL_VFROM,
		ACL_VTO,
		COM_VFSEC,
		COM_VTSEC,
		ACL_AMT,
		COM_SCD,
		COM_CTSEC,
		PLM_CDT,
		ACL_DT,
		ACL_CMPYN,
		ACL_RMK,
		USR_CD,
		SYS_DT,
		COM_CESEC,
		COM_BRAND )
	VALUES (
		#{plm_no},
		'C0929',
		'C01090',
		'C21I',
		'C02I',
		'C07P',
		'C21B',
		#{sti_cd},
		'C2404',
		'C2501',
		5000,
		#{com_scd},
		'C06L',
		#{plm_cdt},
		#{plm_cdt},
		'N',
		'기타추가비용 지급정산금액 = 5000',
		#{sti_cd},
		GETDATE(),
		'C292',
		#{com_brand} )

]]>
</insert>
 
<insert id="insertSigonWorkTimeOver" parameterType="HashMap">
<![CDATA[
	 INSERT INTO TC_PLANDTL (
	      PLM_NO,
	      COM_PLDSEC,
	      ORD_SSEQ,
	      ORD_ISEQ,
	      ITM_CD,
	      COL_CD,
	      SET_CD,
	      COL_SCD,
	      PLD_EQTY,
	      PLD_FQTY,
	      PLD_FAMT,
	      PLD_CRAMT,
	      PLD_CFAMT,
	      PLD_CUSAMT,
	      COM_RDSEC,
	      PLD_RMK,
	      USR_CD,
	      SYS_DT,
	      COM_ACD,
	      COM_SVND,
	      COM_VFSEC,
	      COM_VTSEC,
	      COM_RASEC,
	      PLD_CSEC,
	      FST_USR,
	      FST_SYS_DT,
	      MOB_STD )
	VALUES (
	      #{plm_no},
	      'C0929',
	      '07P',
	      '001',
	      '',
	      '',
	      '',
	      '',
	      1,
	      1,
	      5000,
	      5000,
	      5000,
	      5000,
	      'C13Y',
	      '저녁시공건(AUTO)',
	      #{sti_cd},
	      GETDATE(),
	      'C01090',
	      'C21I',
	      'C2404',
	      'C2501',
	      'C12C',
	      'Y',
	      #{sti_cd},
	      GETDATE(),
	      'C13Y')
]]>
</insert>
 
<select id="selectSigongArrivalTimeCheck" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[
	SELECT REM_FTM DATA1
	FROM TC_RESMST WITH (NOLOCK)
	WHERE REM_DT = #{rem_dt}
	 AND REM_SEQ = #{rem_seq}
	 AND REM_FTM BETWEEN 'C70037' AND 'C70049'
]]>
</select>

<select id="selectSigongWorkTimeCheck" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[
	SELECT CASE WHEN REPLACE(CONVERT(NVARCHAR(8), CONVERT(TIME, MOB_STARTTM), 120), ':', '') >= '180000' THEN 'Y' ELSE 'N' END DATA1      
	FROM TC_PLANMST WITH (NOLOCK)
	WHERE PLM_NO = #{plm_no}
]]>
</select>

<insert id="insertSigongWallFixAcc" parameterType="HashMap">
<![CDATA[
	INSERT INTO TC_ACTLIST (
		PLM_NO,
		COM_ASEC,
		COM_ACD,
		COM_SVND,
		COM_AGSEC,
		COM_DPSEC,
		ACL_VFROM,
		ACL_VTO,
		COM_VFSEC,
		COM_VTSEC,
		ACL_AMT,
		COM_SCD,
		COM_CTSEC,
		PLM_CDT,
		ACL_DT,
		ACL_CMPYN,
		ACL_RMK,
		USR_CD,
		SYS_DT,
		COM_CESEC,
		COM_BRAND )
	VALUES (
		#{plm_no},
		'C0928',
		'C01208',
		'C21B',
		'C02I',
		'C07P',
		'C21B',
		#{sti_cd},
		'C2402',
		'C2501',
		5000,
		#{com_scd},
		'C06L',
		#{plm_cdt},
		#{plm_cdt},
		'N',
		'기타추가비용 지급정산금액 = 5000',
		#{sti_cd},
		GETDATE(),
		'C292',
		#{com_brand}
	)

]]>
</insert> 

<insert id="insertSigongWallFix" parameterType="HashMap">
<![CDATA[
	INSERT INTO TC_PLANDTL (
	      PLM_NO,
	      COM_PLDSEC,
	      ORD_SSEQ,
	      ORD_ISEQ,
	      ITM_CD,
	      COL_CD,
	      SET_CD,
	      COL_SCD,
	      PLD_EQTY,
	      PLD_FQTY,
	      PLD_FAMT,
	      PLD_CRAMT,
	      PLD_CFAMT,
	      PLD_CUSAMT,
	      COM_RDSEC,
	      PLD_RMK,
	      USR_CD,
	      SYS_DT,
	      COM_ACD,
	      COM_SVND,
	      COM_VFSEC,
	      COM_VTSEC,
	      COM_RASEC,
	      PLD_CSEC,
	      FST_USR,
	      FST_SYS_DT,
	      MOB_STD )
	VALUES (
	      #{plm_no},
	      'C0928',
	      '07P',
	      '001',
	      '',
	      '',
	      '',
	      '',
	      1,
	      1,
	      5000,
	      5000,
	      5000,
	      5000,
	      'C13Y',
	      '벽고정시공건(AUTO)',
	      #{sti_cd},
	      GETDATE(),
	      'C01208',
	      'C21B',
	      'C2402',
	      'C2501',
	      'C12A',
	      'Y',
	      #{sti_cd},
	      GETDATE(),
	      'C13Y')


]]>
</insert> 


<select id="selectPhoneIDAll" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPPushMessage">
<![CDATA[
	SELECT STI_CD AS sti_cd, PHONE_ID AS token
	FROM TC_STINF TCS WITH (NOLOCK)
	WHERE TCS.PHONE_ID IS NOT NULL
	  AND TCS.STI_RANK = 'Y'  				
]]>
</select>

<select id="selectPhoneID" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPPushMessage">
<![CDATA[
	SELECT STI_CD AS sti_cd, PHONE_ID AS token
	FROM TC_STINF TCS WITH (NOLOCK)
	WHERE ( TCS.COM_SCD = #{com_scd} OR TCS.STI_CD = #{com_scd} ) 
	  AND TCS.PHONE_ID IS NOT NULL
	  AND TCS.STI_RANK = 'Y'  				
]]>
</select>

<update id="deleteUsedPhoneID" parameterType="HashMap">
<![CDATA[
	UPDATE TC_STINF
	   SET PHONE_ID = NULL
	 WHERE PHONE_ID = #{phone_id}
]]>
</update> 

<select id="selectMobileCmVersion" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[
	SELECT ISNULL(PHONE_ID, '') AS DATA1, ISNULL(MOBILECM_VERSION, '') AS DATA2 
	  FROM TC_STINF WITH (NOLOCK)
	 WHERE COM_SCD = #{com_scd}
	   AND STI_CD = #{sti_cd}	
]]>
</select>

<update id="updatePhoneID" parameterType="HashMap">
<![CDATA[
	UPDATE TC_STINF
	   SET PHONE_ID = #{phone_id}
	 WHERE COM_SCD = #{com_scd}
	   AND STI_CD = #{sti_cd}
]]>
</update> 
 
<update id="updateMobileCmVersion" parameterType="HashMap">
<![CDATA[
	UPDATE TC_STINF
	   SET MOBILECM_VERSION = #{version_code}
	 WHERE COM_SCD = #{com_scd}
	   AND STI_CD = #{sti_cd}
]]>
</update> 
 
<select id="selectNotifyGetDate" parameterType="java.util.HashMap" resultType="com.fursys.mobilecm.vo.DataResult">
<![CDATA[
	SELECT CONVERT(NVARCHAR(20), GETDATE(), 2) + ' ' + CONVERT(NVARCHAR(8), GETDATE(), 8) DATA1      
	
]]>
</select>

<insert id="insertNotify" parameterType="HashMap" useGeneratedKeys="true" keyProperty="seq_no">
<selectKey keyProperty="seq_no" resultType="Integer" order="AFTER"> 
	SELECT IDENT_CURRENT('TC_NOTIFY')
</selectKey>

<![CDATA[
	INSERT INTO TC_NOTIFY (
	       SEND_FROM_SYSTEM, SEND_TO_SYSTEM, SEND_DT, SENDER_ID, SEND_TEXT, RECEIVE_ID, RECEIVE_PHONE_ID )
	VALUES (
	       #{send_from_system}, #{send_to_system}, GETDATE(), #{sender_id}, #{send_text}, #{receive_id}, #{receive_phone_id})
     
]]>
</insert> 

<update id="deleteAttachFile" parameterType="HashMap">
<![CDATA[
	DELETE
	 FROM TY_ATTCHFILE
	WHERE ATTCH_FILE_ID = #{attch_file_id}
	AND ATTCH_DIV_CD = #{attch_div_cd}	 
	AND ATTCH_FILE_SNUM = #{attch_file_snum}
	
]]>
</update> 

<update id="deleteAttachFileAll" parameterType="HashMap">
<![CDATA[
	DELETE
	 FROM TY_ATTCHFILE
	WHERE ATTCH_FILE_ID = #{attch_file_id}
	AND ATTCH_DIV_CD = #{attch_div_cd}
	
]]>
</update> 

<select id="selectSigongAttachFileList"  parameterType="HashMap" resultType="com.fursys.mobilecm.vo.erp.ERPAttachFileList">
<![CDATA[	
	SELECT ATTCH_FILE_ID,
	       ATTCH_FILE_SNUM,
	       ATTCH_DIV_CD,
	       REAL_ATTCH_FILE_NAME,
	       VIRTUAL_ATTCH_FILE_NAME,
	       ATTCH_FILE_PATH,
	       ATTCH_FILE_SIZE
	FROM TY_ATTCHFILE WITH(NOLOCK)	
	WHERE ATTCH_FILE_ID = #{attch_file_id}
	AND ATTCH_DIV_CD = #{attch_div_cd}
	ORDER BY ATTCH_FILE_SNUM DESC
]]>
</select>

</mapper>